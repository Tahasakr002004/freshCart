<div class="max-w-5xl mx-auto px-4 py-10">
  <h1 class="text-2xl font-bold text-gray-900 mb-6">Cart</h1>

  @if (loading()) {
    <p class="text-gray-500">Loading cart...</p>
  } @else if (error()) {
    <p class="text-red-600">{{ error() }}</p>
  } @else if (items().length === 0) {
    <div class="rounded border border-dashed border-gray-300 p-6 text-gray-600">
      <p class="mb-2">Your cart is empty.</p>
      <a routerLink="/shop" class="text-indigo-600 hover:underline">Browse products</a>
    </div>
  } @else {
    <div class="space-y-4">
      @if (message()) {
        <div class="rounded bg-green-50 text-green-700 px-3 py-2 text-sm">
          {{ message() }}
        </div>
      }

      <ul class="divide-y divide-gray-200 bg-white shadow rounded">
        @for (item of items(); track item.product) {
          <li class="p-4 sm:p-5 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
            <div>
              <div class="font-semibold text-gray-900">{{ item.productName }}</div>
              <div class="text-gray-600 text-sm">
                Unit price: {{ item.unitPrice | currency:'USD':'symbol':'1.2-2' }}
              </div>
            </div>

            <div class="flex items-center gap-3">
              <div class="flex items-center rounded border border-gray-200">
                <button type="button" class="px-2 py-1 text-sm" (click)="decrease(item)">-</button>
                <input
                  type="number"
                  min="1"
                  class="w-14 border-0 text-center focus:ring-0 py-1"
                  [value]="item.quantity"
                  (change)="onQuantityInput(item, $event)"
                />
                <button type="button" class="px-2 py-1 text-sm" (click)="increase(item)">+</button>
              </div>
              <div class="text-right min-w-[120px]">
                <div class="text-gray-700 text-sm">
                  {{ item.unitPrice | currency:'USD':'symbol':'1.2-2' }}
                </div>
                <div class="font-semibold text-gray-900">
                  {{ item.unitPrice * item.quantity | currency:'USD':'symbol':'1.2-2' }}
                </div>
              </div>
              <button
                type="button"
                class="text-sm text-red-600 hover:underline"
                (click)="remove(item)"
              >
                Remove
              </button>
            </div>
          </li>
        }
      </ul>

      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between bg-gray-50 rounded p-4 border border-gray-200">
        <div class="text-gray-700 font-medium">
          Total: <span class="text-gray-900 font-semibold">{{ total() | currency:'USD':'symbol':'1.2-2' }}</span>
        </div>
        <div class="flex items-center gap-3 mt-3 sm:mt-0">
          <button
            type="button"
            class="rounded border border-gray-300 px-4 py-2 text-sm hover:bg-gray-100 cursor-pointer"
            (click)="clearCart()"
          >
            Clear cart
          </button>
          <a
            routerLink="/checkout"
            class="rounded bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-500 cursor-pointer text-center"
          >
            Checkout
          </a>
        </div>
      </div>
    </div>
  }
</div>
